<ion-content hide-nav-bar="true" padding [ngSwitch]="citP.current_div" [ngStyle]="{ 'background-color': citP.bg_color }" text-wrap>


  <div *ngSwitchCase="'div_settings'" style="font-size: 200% !important;">

    <i>
      <p *ngIf="internet_on" style="color: red;">Warning: it seems you are connected to the internet. Please turn it off to avoid interruptions!</p>
    </i>

    <br />
    <div style="font-size: 90%;line-height:150%;font-weight:bold">
      Please fill in your gender and age below.
    </div>

    <ion-item>
      <ion-label style="font-size: 160% !important;margin-bottom:0;color:black">Gender</ion-label>
      <ion-select [(ngModel)]="citP.gender" [ngModelOptions]="{standalone: true}" interface='popover' style="font-size: 140%;">
        <ion-option value='1'>Male</ion-option>
        <ion-option value='2'>Female</ion-option>
      </ion-select>
    </ion-item>
    <br />
    <ion-item>
      <ion-label style="font-size: 160% !important;margin-bottom:0;color:black;" fixed>Age</ion-label>
      <ion-input [(ngModel)]="citP.age" type="number" [ngModelOptions]="{standalone: true}" style="font-style:normal;" text-right></ion-input>
    </ion-item>
    <br />
    <br />
    <div style="font-size: 90%;line-height:150%;font-weight:bold">
      Please look through the list of words below and select maximum three words that seem to you meaningful or in any way notably different from the rest of the words in this list.
    </div>
    <br />



    <ion-item>
      <ion-label style="font-size: 160% !important;margin-bottom:0;color:black">Words</ion-label>
      <ion-select [(ngModel)]="dataShare.checkboxed" interface='popover' style="font-size: 140%;" multiple="true" [selectOptions]="{title:'Choose max. 4'}" (ionChange)="dataShare.chb_change('the_item')">
        <ion-option *ngFor="let the_item of dataShare.allpossiblewords" (ionSelect)="dataShare.chb_change(the_item)">{{the_item}}</ion-option>
      </ion-select>
    </ion-item>

    <div style="text-align:center">
      <br />
      <br />
      <hr />
      <button ion-button type="button" onclick="initials();" style="font-size: 120% !important;">Start task<span *ngIf="citP.subj_id != ''">&nbsp; ({{citP.subj_id}})</span></button>
    </div>

    <br />
    <br />
    <br />
    <br />
  </div>


  <div *ngSwitchCase="'div_consent'">
    <span style="line-height: 150%;">
      {{trP.consent[trP.lang]}} {{consentitems}}
    </span>
    <br /><br />
    <div text-center>
      {{trP.consent_q[trP.lang]}}
      <br /><br />
      <button ion-button *ngIf="consentset.indexOf('1') !== -1" (tap)="init_cit(1);" color='light' block>{{trP.consent_a[trP.lang][0]}}</button>
      <br />
      <button ion-button *ngIf="consentset.indexOf('2') !== -1 && consentset.indexOf('1') !== -1" (tap)="init_cit(2);" color='light' block>{{trP.consent_a[trP.lang][1]}}</button>
      <button ion-button *ngIf="consentset.indexOf('2') !== -1 && consentset.indexOf('1') === -1" (tap)="init_cit(2);" color='light' block>{{trP.consent_a[trP.lang][0]}}</button>
      <br />
      <button ion-button *ngIf="consentset.indexOf('0') !== -1" (tap)="init_cit(0);" color='light' block>{{trP.consent_a[trP.lang][2]}}</button>
      <br />
    </div>
  </div>


  <div *ngSwitchCase="'div_blockstart'">
    <span [innerHTML]="san_html(citP.block_text)"></span>
    <div text-center>
      <br />
      <br />
      <button ion-button (tap)="citP.runblock();">{{trP.start[trP.lang]}}</button>
      <div *ngIf='citP.block_text.slice(0, 13) === "<span></span>"'>
        <br />
        <br />
        <button ion-button style='text-transform: none;' (tap)='citP.block_text = citP.block_texts[citP.blocknum]' color='light' block>{{trP.show_inst[trP.lang]}}</button>
      </div>
      <br />
    </div>
  </div>


  <div *ngSwitchCase="'div_cit_main'">

    <p (touchstart)="citP.touchstart($event, 'resp_a');" (touchend)="citP.touchend($event, 'resp_a');" id="resp_left" class="resp_buttons"></p>

    <p (touchstart)="citP.touchstart($event, 'resp_b');" (touchend)="citP.touchend($event, 'resp_b');" id="resp_right" class="resp_buttons"></p>

    <canvas width="10" height="10" #thecanvas></canvas>
    <p id="feed_id"><b>{{citP.feed_text}}</b></p>

    <p id="stimulus">{{citP.stimulus_text}}</p>

    <p id="start_text" (tap)="citP.visib.start_text = false; citP.start_trials();" *ngIf="citP.visib.start_text">{{trP.taptostart[trP.lang]}}</p>
  </div>


  <div *ngSwitchCase="'div_end'">
    <ion-title class='center' style="padding:8vw" (swiperight)="sethome();">
      {{trP.cit_completed[trP.lang]}}
    </ion-title>
  </div>


  <div *ngSwitchCase="'div_results'">

    <div [hidden]="citP.current_menu != 'm_testres'">

      <button ion-button small type='button' (tap)="goto_menu('m_prevs')" color="light" block>Back to list</button>
      <hr>

      <div style="clear:both;font-size:110%;text-align:center;padding-bottom:1.5vw;padding-top:1.5vw">
        Summary CIT results for <b>{{citP.cit_results.subj_id}}</b>
      </div>
      <div style="text-align:center;padding-bottom:4.5vw">
        (Date: <b>{{citP.cit_results.date}}</b>)
      </div>

      <div style="overflow-x:auto;background:#f1f1f1">
        <table class='results_table'>
          <tr>
            <th></th>
            <th>RT<sub>P&nbsp;vs&nbsp;I</sub><br /><span class='res_unit'>(ms)</span></th>
            <th>RT<sub>P&nbsp;(SD)</sub><br /><span class='res_unit'>(ms)</span></th>
            <th>RT<sub>I&nbsp;(SD)</sub><br /><span class='res_unit'>(ms)</span></th>
            <th><i>d</i><sub>CIT</sub><br /><span class='res_unit'>&nbsp;</span></th>
            <th>AR<sub>P&nbsp;vs&nbsp;I</sub><br /><span class='res_unit'>(%)</span></th>
            <th>AR<sub>P</sub><br /><span class='res_unit'>(%)</span></th>
            <th>AR<sub>I</sub><br /><span class='res_unit'>(%)</span></th>
          </tr>
          <tr *ngFor="let num of [1, 2, 3, 4, 5];">
            <td>
              Probe&nbsp;{{num}}
            </td>
            <td>
              {{citP.cit_results['probe' + num]['rt_p_vs_i']}}
            </td>
            <td>
              {{citP.cit_results['probe' + num]['rt_probe']}}&nbsp;({{citP.cit_results['probe' + num]['rt_probe_sd']}})
            </td>
            <td>
              {{citP.cit_results['probe' + num]['rt_irr']}}&nbsp;({{citP.cit_results['probe' + num]['rt_irr_sd']}})
            </td>
            <td style="color:#8b0000;">
              {{citP.cit_results['probe' + num]['dcit']}}
            </td>
            <td>
              {{citP.cit_results['probe' + num]['acc_probe']}}
            </td>
            <td>
              {{citP.cit_results['probe' + num]['acc_irr']}}
            </td>
            <td>
              {{citP.cit_results['probe' + num]['acc_p_vs_i']}}
            </td>
          </tr>
        </table>
      </div>
      <br />

      Overall accuracy rates (number of correct responses per number of all trials): {{citP.cit_results.ar_overall}}.
      <br />
      <br />
      <div (tap)="ele.class = ele.class == 'show' ? '' :  'show'" [ngClass]="{ expandable : true, hideChildren : ele.class !== 'show', showChildren : ele.class === 'show' }" #ele>
        <b>Description of variables</b>
        <span id='expand'><b>(tap to show)</b></span>
        <span id='collapse'><b>(tap to hide)</b></span>
        <div>
          Response times (for all correct responses, in milliseconds): probe RT mean minus irrelevant RT mean (RT<sub>P&nbsp;vs&nbsp;I</sub>), probe RT mean and standard deviation (RT<sub>P&nbsp;(SD)</sub>), irrelevant RT mean and standard
          deviation (RT<sub>I&nbsp;(SD)</sub>),
          uncorrected Cohen's d between all probe and all irrelevant RTs (<i>d</i><sub>CIT</sub>). Accuracy rates (ratio of correct responses compared to incorrect and too slow responses, in percentage): probe accuracy rate minus irrelevant
          accuracy
          rate (AR<sub>P&nbsp;vs&nbsp;I</sub>), probe accuracy rate (AR<sub>P</sub>), irrelevant accuracy rate (AR<sub>I</sub>). Responses with RT below 150 ms are excluded from all RT and AR analysis, except for the overall accuracy rate
          calculation. Trials (i.e., responses) from practice rounds are not included in any of the statistics above.
        </div>
      </div>

      <br />

      <div (tap)="ele2.class = ele2.class == 'show' ? '' :  'show'" [ngClass]="{ expandable : true, hideChildren : ele2.class !== 'show', showChildren : ele2.class === 'show' }" #ele2>
        <b>Evaluation using <i>d</i><sub>CIT</sub></b>
        <span id='expand'><b>(tap to show)</b></span>
        <span id='collapse'><b>(tap to hide)</b></span>
        <div>
          The <i>d</i><sub>CIT</sub> measure might be used to evaluate whether or not a given probe was recognized. The <i>d</i><sub>CIT</sub> typically falls between around âˆ’0.3 and 0.8, where a larger number always indicates a larger likelihood
          of
          the
          recognition of the given probe. As of yet, there is no established optimal cut-off value for the evaluation, but, based on a rough approximation in view of previous results, the following table depicts some possible evaluative labels for
          given boundaries.
          <br />
          <br />

          <div style="overflow-x:auto;white-space: nowrap;">
            <table class='dcit_table'>
              <tr>
                <td><i>d</i><sub>CIT</sub> > 0.4</td>
                <td>strong indication of recognition</td>
              </tr>
              <tr>
                <td><i>d</i><sub>CIT</sub> > 0.3 and <i>d</i><sub>CIT</sub>
                  <= 0.4</td> <td>fair indication of recognition
                </td>
              </tr>
              <tr>
                <td><i>d</i><sub>CIT</sub> > 0.1 and <i>d</i><sub>CIT</sub>
                  <= 0.3</td> <td>weak indication of recognition
                </td>
              </tr>
              <tr>
                <td><i>d</i><sub>CIT</sub> > 0 and <i>d</i><sub>CIT</sub>
                  <= 0.1</td> <td>indeterminate
                </td>
              </tr>
              <tr>
                <td><i>d</i><sub>CIT</sub> > âˆ’0.1 and <i>d</i><sub>CIT</sub>
                  <= 0</td> <td>weak indication of non-recognition
                </td>
              </tr>
              <tr>
                <td><i>d</i><sub>CIT</sub>
                  <= âˆ’0.1</td> <td>fair indication of non-recognition
                </td>
              </tr>
            </table>
          </div>

          <br />
          (There is no strong indication of innocence: a very fast probe response is no more expected in case of innocence than in case of guilt.)
        </div>
      </div>

      <br />
      For more details, see the <a href="https://github.com/gasparl/citapp_phone" target="_blank">online
        documentation</a>.
      <br />
      <br />
      <hr />
      <br />

      <div style="padding-bottom:3.5vw">
        <i>Path to full data file:</i><br />
        <div style="overflow-x:auto" class='selectable'>
          <b>{{citP.path}}</b>
        </div>
      </div>

      <div style="padding-bottom:3.5vw">
        <i>File name:</i><br />
        <div style="overflow-x:auto" class='selectable'>
          <b>{{citP.cit_results.file_nam_disp}}</b>
        </div>
      </div>
      <hr />
      <button ion-button small type='button' (tap)="goto_menu('m_sendin')" color="light" block>Get full data</button>
    </div>


    <div [hidden]="citP.current_menu != 'm_sendin'">

      <button ion-button small type='button' (tap)="goto_menu('m_prevs')" color="light" block>Back to list</button>
      <hr>

      <div style="font-size:110%;text-align:center;padding-bottom:1.5vw;padding-top:1.5vw">
        Forward data with subject ID <b>{{citP.cit_results.subj_id}}</b>
      </div>
      <div style="text-align:center;padding-bottom:4.5vw">
        (Date: <b>{{citP.cit_results.date}}</b>)
      </div>

      <div style="text-align:left;padding-left: 16px;padding-top:1.5vw;">
        First, please try to upload the data to the server by pressing the button below. If the upload is successfull, the button will disappear and a success message will appear in its place. If the upload fails, you will get an error message:
        try again or send data using one of the other options below.
      </div>
      %%%% WARN ABOUT INTERNET
      <span>&nbsp;</span>
      <button ion-button type='button' (tap)="sendviaphp()" color="light" block>Send to server</button>


      <div style="text-align:left;padding-left: 16px;padding-top:1.5vw;">
        The data can be sent (shared, stored) via any chosen local application (e.g. email, cloud storage, etc.).
      </div>
      <span>&nbsp;</span>
      <button ion-button type='button' (tap)="sendviaapp()" color="light" block>Choose application</button>

      <br />
      <div style="text-align:left;padding-left: 16px;padding-top:1.5vw;">
        You can also just simply copy the data to the clipboard. Afterwards it can be pasted into any other application.
      </div>
      <span id="copyfeed_id" style="color:green;">&nbsp;</span>
      <button ion-button type='button' (tap)="to_clipboard()" color="light" block>Copy to clipboard</button>

      <br />
      <hr />
      <br />

      <div style="padding-bottom:3.5vw">
        <i>Path to all CIT results files on the device:</i><br />
        <div style="overflow-x:auto" class='selectable'>
          <b>{{citP.path}}</b>
        </div>
      </div>

      <div style="padding-bottom:3.5vw">
        <i>File name:</i><br />
        <div style="overflow-x:auto" class='selectable'>
          <b>{{citP.cit_results.file_nam_disp}}</b>
        </div>
      </div>
      <hr />
      <button ion-button small type='button' (tap)="goto_menu('m_testres')" color="light" block>Show main results</button>
    </div>

    <br />
    <br />
    <br />
    <br />
  </div>

  <!-- app console for testing
  <b>{{mycl}}</b>
  <br />
  <input (keypress)="onChange($event)" [(ngModel)]="to_exec" type="text" style="color:red; position:absolute;width:100%;">
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
    console end -->

</ion-content>
